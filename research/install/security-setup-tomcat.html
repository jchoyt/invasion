<html><head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"></head><body><h2> <csfield name="title"></csfield></h2> <csfield name="id_author" before="by " hrefaction="pub"><br> <csfield name="date"> <!-- sidebar begins --> <!-- don't move sidebars --> <!-- sidebar ends -->   

 <p>
Implementing security for Web applications is a mandatory task for
architects and Web application developers. In J2EE, the Web containers
have support for built-in security mechanisms for their applications.</p>  <p>There
are two major components of Web application security: authentication
and authorization. J2EE-based Web containers offer three types of
authentication mechanisms: basic, form-based, and mutual
authentication. Most Web applications use the form-based authentication
mechanism, since it allows applications to customize the authentication
user interface. Web containers implement authorization on Web resources
of applications, using security roles defined in the deployment
descriptor of the Web application. </p> <p> There are three issues
that software architects and software developers come across using the
form-based authentication mechanism: </p>  <ul> <li><p> How the
form-based authentication works with other security realms, such as
database and LDAP (this is necessary because most organizations may
already have authentication information in database or LDAP form). </p></li>  <li><p> How to add or delete authorization roles declared in the deployment descriptor (<code>web.xml</code>) of the Web application. </p></li>   <li><p>
Web containers enforce authorization at Web resource level; however, an
application needs to enforce authorization at its functionality level
within a single Web resource. </p></li> </ul>  <p> Despite the fact
that there is plenty of documentation and many examples available for
form-based authentication, none of them clarifies these issues. Hence,
most applications have implemented security in their own way. </p>  <p>
This article demonstrates how the form-based authentication mechanism
works with other security realms, especially the database. It also
explains how Web containers use the security roles to implement
authorization, and how applications can extend these security roles to
protect functionalities within single resource. </p>  

<h3>Form-Based Authentication</h3> 
<p> Form-based authentication lets developers customize the authentication user interface. The login-config section of <code>web.xml</code> defines the type of authentication mechanism, and the URIs to login and error pages. </p>  

<pre><code>&lt;login-config&gt;
&lt;auth-method&gt;FORM&lt;/auth-method&gt;
&lt;form-login-config&gt;
&lt;form-login-page&gt;/login.jsp&lt;/form-login-page&gt;
&lt;form-error-page&gt;/fail_login.html&lt;/form-error-page&gt;
&lt;/form-login-config&gt;
&lt;/login-config&gt;</code></pre>

<p>The login form must contain fields for entering username and password. These fields must be named <code>j_username</code> and <code>j_password</code>, respectively. This form should post these values to <code>j_security_check</code> logical name. </p> <p> Here is an example showing how the form should be coded into an HTML page: </p> 

<pre><code>&lt;form method="POST" action="j_security_check"&gt;
&lt;input type="text" name="j_username"&gt;
&lt;input type="password" name="j_password"&gt;
&lt;/form&gt;</code></pre>

<p> This form of authentication, which uses base64 encoding, can expose
username and password unless all connections are over SSL. </p> <p>
The Web containers activate the authentication mechanism that has been
configured for that resource, when protected Web resources are
accessed. </p> <p> Web containers perform the following steps to implement security of a Web application. </p> <ol> <li><p>Determines whether the user has been authenticated when the protected Web resources are accessed.</p></li> <li><p>If
the user has not been authenticated yet, requests that the user provide
security credentials by redirecting to the login page defined in the
deployment descriptor.</p></li> <li><p>Validates the user's credentials against the security realm configured for the container.</p></li> <li><p>Determines whether the authenticated user is authorized to access Web resources defined in the deployment descriptor (<code>web.xml</code>).</p></li> </ol>  <p>
In the deployment descriptor of a Web application, form-based
authentication does not specify the security realm, as the basic
authentication mechanism does. In other words, it does not explicitly
declare the type of security realm it should use to authenticate a
user. This causes some confusion as to what security realm it actually
uses to authenticate the user. </p> <p> Web containers perform the following steps to validate a user: </p> <ol> <li><p>Determines the configured security realm for the container.</p></li> <li><p>Uses that security realm for authentication.</p> </li></ol> <p>
Since database and LDAP provide greater flexibility in maintaining
information, most organizations may want this persistence for security
authentication and authorization information. </p> <p> Many Web containers have support for different types of security realms: database, LDAP, and custom realm.  </p> 

<p> For example, in the Tomcat Web container,  <code>server.xml </code>  configures database as its security realm. </p> 

<pre><code>&lt;Realm 
className="org.apache.catalina.realm.JDBCRealm" 
debug="99"
driverName="oracle.jdbc.driver.OracleDriver"
connectionURL="jdbc:oracle:thin:@{IPAddress}:{Port}:{Servicename}"
         connectionName="{DB Username}"
         connectionPassword="{Password}"
         userTable="users" 
userNameCol="username" 
         userCredCol="password"
userRoleTable="user_roles" 
roleNameCol="rolename" 
/&gt;</code></pre>

<p> The <code>&lt;Realm&gt;</code> tag of  Tomcat's <code>server.xml</code>
defines the type of security realm that the container should use to
authenticate a user. Note that the container uses this realm for Web
applications whose authentication mechanism is form-based.</p> 

 <p> <b>Note:</b> Please see the sections on deploying  database security realm support for Tomcat and WebLogic below. </p>  <csinclude record="b/730" template="b/article_sidebar2.view">   

<h4>Authorization</h4> 
<p> Once the user has been authenticated, the container retrieves
security roles for the authenticated user and checks to see if the user
belongs to one of the roles defined in the <code>&lt;auth-constraint&gt;</code> tag of the deployment descriptor. The Web container displays an error message if the user does not belong to one of roles. </p>  <p> The <code>&lt;security-constraint&gt;</code> tag of the deployment descriptor (<code>web.xml</code>) defines protected Web resources and a list of roles that have access to these Web resources. </p>  

<pre><code>&lt;security-constraint&gt;
&lt;web-resource-collection&gt;
&lt;web-resource-name&gt;AdminPages&lt;/web-resource-name&gt;
&lt;description&gt; accessible by authorised users &lt;/description&gt;
&lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;
&lt;http-method&gt;GET&lt;/http-method&gt;
&lt;/web-resource-collection&gt;
&lt;auth-constraint&gt;
&lt;description&gt;These are the roles who have access&lt;/description&gt;
&lt;role-name&gt;manager&lt;/role-name&gt;
&lt;/auth-constraint&gt;
&lt;/security-constraint&gt;</code></pre>


<p> Web containers enforce authorization at a page level. However,
commercial applications may also want to enforce authorization on
functionalities within a single page. This may require that some
additional new application-specific security roles be defined in the
application. To control access to functionalities, the application
needs to understand the notion of privileges for a role. The Web
container specification does not address privileges. </p> 

<p> Since authorization roles are dynamic, developers often get
confused as to whether these security roles need to be added to the
deployment descriptor. Web containers just need one role defined in the
deployment descriptor for the application to take advantage of security
support. So, the application can define one high-level role and assign
all users to this role. This allows all users in this role to have
access to the Web resources. </p>  

<p>In addition, the application can define additional roles to enforce
authorization on low-level functionalities within a single Web
resource. These low-level security roles do not need to be in the
deployment descriptor, since the application has been configured with a
high-level security role that contains all of the users in the
application. This allows Web applications to take advantage of
container authorization support, and to implement application-specific
authorization. </p> 

<p> For example, you can define an administrator role for all of the
users at a high level in the deployment descriptor to protect
administration Web resources. This allows all of the users in the
administrator role to access the administration pages. To control other
functionalities within the administration pages, you can create new
roles, such as <code>sysadmin</code> or  <code>appadmin</code>, within the application. </p> 

<p> The application can extend these security roles to have privileges.
Then, the application can use these privileges to control access to its
functionalities. </p>  

<p> Despite the fact that application-specific security roles are not
defined in the deployment descriptors, these roles can still be used in
the <code>isUserInRole</code> method to determine whether the user in these security roles. </p>  


<h4>Advantages</h4> 
<ul> <li><p>Web applications do not need to implement the
authentication mechanism by themselves. It is simply a matter of
configuring the Web application.</p></li> 
<li><p>Web applications can implement programmatic security using <code>getRemoteUser</code>, <code>IsUserInRole</code>, and <code>getUserPrincipal</code> methods.</p></li> 
<li><p>The Web container is capable of propagating authentication information to EJB containers.</p></li> </ul>  


<h3>Configuring the Database Security Realm in Tomcat</h3>
 <ol> 
<li><p>Create User Table</p> <p>This table needs the username and password columns.</p> <p><code>create table users (username varchar(20) not null, password(20) not null)</code></p> </li>

<li><p>Create Role Table</p> <p>This table maintains the list of roles in application. It just needs role name column in the table.</p> <p><code>create table roles (rolename varchar(20) not null)</code></p>  </li>

<li><p>Create User-Role Association Table</p> 
<p>This table maintains association between a user and roles. A user can belong to one or more roles.</p> 
<p><code>create table user_roles (username varchar(20) not null, rolename varchar(20) not null)  </code></p> </li>

<li><p>Insert data into tables</p> 
<p><code>insert into users values('user1', 'password')</code></p> 
<p><code>insert into role values('manager')<br> 
insert into user_roles values('user1', 'manager')</code></p> </li>

<li><p>Create User Table</p> 
<p>This table needs the username and password columns.</p> <p><code>create table users (username varchar(20) not null, password(20) not null)</code></p> </li>

<li><p>Create Role Table</p> 
<p>This table maintains the list of roles in the application. It just needs the role name column in the table.</p> 
<p><code>create table roles (rolename varchar(20) not null)</code></p> </li> 

<li><p>Create User-Role Association Table</p> 
<p>This table maintains association between a user and roles. A user can belong to one or more roles.</p> 
<p><code>create table user_roles (username varchar(20) not null, rolename varchar(20) not null)</code></p></li>

<li><p>Insert data into tables</p> 
<p><code>insert into users values('user1', 'password')</code></p> 
<p><code>insert into role values('manager')</code></p> 
<p><code>insert into user_roles values('user1', 'manager') </code></p></li>
 
<li><p>Configure Tomcat (This example uses the Oracle thin driver) by copying this information in <code>server.xml</code> in the <code>{tomcat}\conf\</code> folder. (Tomcat uses memory realm as default realm. Comment the memory realm.)</p>  

<pre><code>&lt;Realm 
className="org.apache.catalina.realm.JDBCRealm" 
         debug="99"
driverName="oracle.jdbc.driver.OracleDriver" 
connectionURL="jdbc:oracle:thin:@{IP address}:{Port}:{Servicename}"
connectionName="{DB Username}"
         connectionPassword="{Password}"
         userTable="users" 
         userNameCol="username" 
         userCredCol="password"
         userRoleTable="user_roles" 
         roleNameCol="rolename" 
/&gt;</code></pre>

<p> Replace the following values with environment values </p>  <p><code>{IP Address}</code> - IP address of database server</p>
<p><code>{Port}</code> - Port number</p>  
<p><code>{Servicename}</code> - Service name</p>  
<p><code>{DB Username}</code> - database login</p>  
<p><code>{Password}</code> - password to database login</p> 
<p><b>Note</b>: You need to have the JDBC driver for your database. (The Oracle thin driver is used in this example.)</p></li> 
<li><p> Copy the Oracle thin driver JAR file or JDBC driver for your database (<code>oracle_thin_driver.jar</code>) into the <code>{tomcat_home}/server/lib</code> directory.</p> </li>
<li><p>Configure the Web application deployment descriptor with security constraints.</p> 

<pre><code>&lt;security-constraint&gt;
&lt;web-resource-collection&gt;
&lt;web-resource-name&gt;Protected Area&lt;/web-resource-name&gt;
&lt;!-- Define the context-relative URL(s) to be protected --&gt;
&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;http-method&gt;DELETE&lt;/http-method&gt;
&lt;http-method&gt;GET&lt;/http-method&gt;
&lt;http-method&gt;POST&lt;/http-method&gt;
&lt;http-method&gt;PUT&lt;/http-method&gt;
&lt;/web-resource-collection&gt;
&lt;auth-constraint&gt;
&lt;role-name&gt;manager&lt;/role-name&gt;
&lt;/auth-constraint&gt;
&lt;user-data-constraint&gt;&lt;transport-guarantee&gt;
NONE&lt;/transport-guarantee&gt;&lt;/user-data-constraint&gt;

&lt;/security-constraint&gt;

&lt;!-- Default login configuration uses form-based authentication --&gt;

&lt;login-config&gt;
&lt;auth-method&gt;FORM&lt;/auth-method&gt;
&lt;realm-name&gt;Example Form-Based Authentication Area&lt;/realm-name&gt;
&lt;form-login-config&gt;
&lt;form-login-page&gt;/jsp/login.jsp&lt;/form-login-page&gt;
&lt;form-error-page&gt;/jsp/error.jsp&lt;/form-error-page&gt;
&lt;/form-login-config&gt;
&lt;/login-config&gt;</code></pre>

<p>Note that the <code>&lt;role-name&gt;</code> value of this tag in <code>&lt;auth-constraint&gt;</code> should be one of the role names in the <code>user-roles</code> table.</p> </li> </ol>  

<h3>Deploying The Sample Program Into Tomcat</h3>
  <ol> <li><p>Configure Tomcat using the instructions defined in the previous section.</p> </li> 
<li><p> Download the <a href="http://onjava.com/onjava/2002/06/12/examples/security-form-based.war"><code>security-form-based.war</code></a> file and copy it into Tomcat's <code>webapps</code> directory. </p></li> 

<li><p>Start the Tomcat server.</p></li> 

<li><p>Open a Web browser and go to <code>http://{ip address:port no}/security-form-based/protected/index.jsp</code>.</p></li> 

<li><p>Type in the username and the password (user1, password).</p> </li></ol>  

<h3>Configuring the Database Security Realm in WebLogic</h3>  <p> There is <a href="http://e-docs.bea.com/wls/docs61/adminguide/cnfgsec.html%20-%201052867"> very good documentation</a> on configuring the database security realm. Please refer to this link. </p>  <p> Configure your Web application deployment descriptor, similar to the one shown in the configuration steps for Tomcat. </p>  
<p> One difference between Tomcat and WebLogic deployment descriptors
is that the deployment descriptor for WebLogic requires the following
section, while Tomcat does not require this section. </p> 


<pre><code>&lt;security-role&gt;
&lt;description&gt;
Manager security role
&lt;/description&gt;
&lt;role-name&gt;
manager
&lt;/role-name&gt;
&lt;/security-role&gt;</code></pre>

<h3>Conclusion</h3>  

<p> This article has provided in-depth understanding of the form-based
mechanism and how it works with database security realms to handle
authentication. Web applications can take advantage of the form-based
mechanism to protect their resources while at the same time using
legacy security realms for authentication information. </p>  

<p> In addition, this article has described the level of authorization
support provided by J2EE Web containers and how you can define new
security roles without modifying the deployment descriptor of a Web
application. </p>    

<h3>Resources</h3> 
<p> Download the source code: <a href="http://onjava.com/onjava/2002/06/12/examples/security.zip">security.zip</a>. </p>  
<p> Download the .war file: <a href="http://onjava.com/onjava/2002/06/12/examples/security-form-based.war">security-form-based.war</a>. </p>  
<p> <a href="http://java.sun.com/j2ee/tutorial/1_3-fcs/doc/Security4.html">Web Tier Security Documentation</a> from Sun. </p>  
<p> <a href="http://jakarta.apache.org/tomcat/tomcat-3.3-doc/JDBCRealm-howto.html">Tomcat JDBC Realm</a>. </p>

  <p> <a href="http://e-docs.bea.com/wls/docs61/adminguide/cnfgsec.html%20-%201052867">WebLogic RDBMS Realm</a> </p>  

<p><i> <csfield name="id_author" after=" " hrefaction="pub"> <csquery path="q/93" where="cs_rid = '{id_author}'"></csquery></csfield></i></p>  <hr noshade="noshade" size="1">  <p>Return to <a href="http://www.onjava.com/">ONJava.com</a>.</p>  




</csinclude></csfield></csfield></body></html>